<!DOCTYPE html>
<html>

<head>
    <title>Reserve Resource</title>


    <link rel="stylesheet" href="{{ url_for('static', filename='reserve.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='sidebar.css') }}">

</head>

<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <img src="{{ url_for('static', filename='RUCKUS-Networks-Logos-artwork_white-orange.png') }}" alt="Logo" class="logo">
        <nav>
            <a href="{{ url_for('inventory.inventory') }}" {% if request.path.startswith('/inventory') %}class="active"
                {% endif %}>Inventory</a>
            <a href="{{url_for('reservation.reserve')}}" {% if request.path.startswith('/reserve') %}class="active" {%
                endif %}>Reserve</a>
            {% if role == 'admin' %}
            <a href="{{ url_for('inventory.admin_page') }}" {% if request.path.startswith('/admin') %}class="active" {%
                endif %}>Admin Page</a>
            <a href="{{ url_for('details.details') }}" {% if request.path.startswith('/details') %}class="active" {%
                endif %}>Details</a>
            {% endif %}
        </nav>
        <div class="sidebar-logout-separator"></div>
        <a href="{{ url_for('auth.login') }}" class="logout-btn">Logout</a>
    </div>
    <div class="container">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo">
        <h1>Reserve a Resource</h1>

        {% if active_count >= max_reservations %}
        <p style="color: rgb(56, 170, 215);">‚ö†Ô∏è You have already reserved {{max_reservations}} active resources. Please wait until one
            ends.</p>
        {% endif %}

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search resource..." onkeyup="filterResources()"
                style="padding: 10px; width: 100%; border-radius: 5px;">
        </div>

        {% if active_count < max_reservations %} <form method="POST">
            <div>
                <label for="start_datetime">Start Date & Time:</label>
                <input type="datetime-local" id="start_datetime" name="start_datetime" required>
            </div>

            <div>
                <label for="end_datetime">End Date & Time:</label>
                <input type="datetime-local" id="end_datetime" name="end_datetime" required>
            </div>

            {% for resource in resources %}
            <div class="resource-row" data-name="{{ resource.name | lower }}">
                <label class="custom-radio">
                    <input type="radio" id="resource_{{ resource.id }}" name="resource_id" value="{{ resource.id }}">
                    <span class="radio-mark"></span>
                </label>
                <span><strong>{{ resource.name }}</strong> | Status: {{ resource.status }} | APs: {{ resource.ap_count
                    }}</span>
            </div>
            {% endfor %}
            <button type="submit" class="reserve-btn" id="reserveBtn" disabled>Reserve</button>
            </form>
            {% endif %}

            {% if active_reservations %}
            <h3>Your Active Reservations</h3>
            <ul class="reservation-list">
                {% for r in active_reservations %}
                <li>
                    <strong>{{ r.resource_name }}</strong> reserved from
                    {{ r.start_datetime }} to {{ r.end_datetime }}
                    {% if r.link %}
                    | <a href="{{ r.link }}" target="_blank">üîó Open Resource</a>
                    {% endif %}
                    | <a href="/delete_reservation/{{ r.id }}"
                        onclick="return confirm('Are you sure you want to cancel this reservation?');"
                        style="color: rgb(226, 85, 14); font-weight: bold;">Cancel</a>
                </li>
                {% endfor %}

            </ul>
            {% endif %}
    </div>

    <script>
        function filterResources() {
            const input = document.getElementById("searchInput").value.toLowerCase();
            document.querySelectorAll('.resource-row').forEach(row => {
                const name = row.dataset.name;
                row.style.display = name.includes(input) ? 'flex' : 'none';
            });
        }
        // Enable reserve button only if a resource is selected
        document.addEventListener('DOMContentLoaded', function () {
            const radios = document.querySelectorAll('input[name="resource_id"]');
            const reserveBtn = document.getElementById('reserveBtn');
            radios.forEach(radio => {
                radio.addEventListener('change', function () {
                    reserveBtn.disabled = false;
                });
            });
            // If none selected, keep disabled
            if (reserveBtn) {
                reserveBtn.disabled = !Array.from(radios).some(r => r.checked);
            }
        });
    </script>
</body>

</html>